name: Build qBittorrent

on:
    push:
        branches:
            - master
        paths:
            - qbittorrent-ee-rpi/
            - .github/workflows/qbittorrent-buildx.yml


jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Vaild Image
              run: docker build -t qbittorrent-ee:test ./qbittorrent-ee-rpi
    build:
        runs-on: ubuntu-latest
        needs: [test]
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Setup Buildx
              uses: crazy-max/ghaction-docker-buildx@v1
              with:
                version: latest
            - name: Build Image
              run: docker buildx build 
               --platform=linux/arm/v7,linux/arm64
               --tag ly0007/qbittorrent-ee-rpi:latest 
               ./qbittorrent-ee-rpi
